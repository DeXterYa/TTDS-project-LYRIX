<script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
    
{% extends "layout.html" %}
{% block content %}
<div id="song_box_-1">
	<form id="search_form" method="POST" action="" class="form-horizontal row g-3 align-items-center" onsubmit="addSpinner()">
		{{ form.hidden_tag() }} 
		<!-- basic lyrics search -->
		<div class="col-md-10">
	 		<div class="form-group">
	 			<div class="input-group">
	 				<div class="col-md-9">
	 			<div class="form-floating">
	 				<!-- lyrics search box with a validation check -->
		 			{% if form.lyrics.errors %}
			            {{ form.lyrics(class="form-control is-invalid", id="floatingInput") }}
			            <div class="invalid-feedback">
			                {% for error in form.lyrics.errors %}
			                    <span>{{ error }}</span>
			                {% endfor %}
			            </div>
			        {% else %}
			        	{% if lyrics %}
			            	{{ form.lyrics(class="form-control", id="floatingInput", placeholder="Search Lyrics", value=lyrics) }}
			            {% else %}
			            	{{ form.lyrics(class="form-control", id="floatingInput", placeholder="Search Lyrics") }}
			            {% endif %}
			        	
			        {% endif %}
			        <!-- floating label -->
	 				<label for="floatingInput">Search Lyrics...</label>

	 			</div>
	 		</div>
	 			{{ form.language(**attrs) }}
	 		</div>
	 		</div>
		</div>

	 	<div class="col-md-2" align="left">
	 		<!-- search button -->
		 	<div class="form-group" >
		 		{{ form.submit(class="btn btn-primary", style="margin: 5px") }}	
		 		<div id="spinner" class="spinner-border spinner-border-sm" role="status" style="display: none">
			  <span class="visually-hidden">Loading...</span>
			</div>	 		
		 	</div>

	 	</div>

	 	<!-- advanced search -->
	 	<div class="col-md-10">
		 	<div class="accordion accordion-flush" id="accordionExample">
		 		<div class="accordion-item">
		 			<!-- header -->
		 			<h2 class="accordion-header" id="headingOne">
		 				{% if singer or startdate or enddate %}
			 				<button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
						    	Advanced Search
						    </button>
					    {% else %}
					    	<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
						    	Advanced Search
						    </button>
					    {% endif %}
		 			</h2>
		 			<!-- body -->
		 			{% if singer or startdate or enddate %}
		 			<div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
		 			{% else %}
		 			<div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
		 			{% endif %}
				    	<div class="accordion-body">
				    		<div class="row g-3 align-items-center">
				    			<div class="col-md-1">
				    				<!-- icon: profile -->
				    				<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-person-circle" viewBox="0 0 16 16">
									  <path d="M13.468 12.37C12.758 11.226 11.195 10 8 10s-4.757 1.225-5.468 2.37A6.987 6.987 0 0 0 8 15a6.987 6.987 0 0 0 5.468-2.63z"/>
									  <path fill-rule="evenodd" d="M8 9a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
									  <path fill-rule="evenodd" d="M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1zM0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8z"/>
									</svg>
				    			</div>
				    			<!-- singer search box -->
					    		<div class="col-md-6 mb-3 ">
						        	<div class="form-group-sm">
						        		<div class="form-floating">
						  					{% if singer%}
						        				{{ form.singer(class="form-control input-sm", id="singerInput", placeholder="singerInput", value=singer) }}
						        			{% else %}
						        				{{ form.singer(class="form-control input-sm", id="singerInput", placeholder="singerInput") }}
						        			{% endif %}
						        			<label for="singerInput">Artist</label>
						        		</div>
						        	</div>
					        	</div>	
				    		</div>
				    		<!-- icon: sand timer -->
				        	<div class="row g-3 align-items-center">
				        		<div class="col-md-1">
				        			<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-hourglass-split" viewBox="0 0 16 16">
									  <path d="M2.5 15a.5.5 0 1 1 0-1h1v-1a4.5 4.5 0 0 1 2.557-4.06c.29-.139.443-.377.443-.59v-.7c0-.213-.154-.451-.443-.59A4.5 4.5 0 0 1 3.5 3V2h-1a.5.5 0 0 1 0-1h11a.5.5 0 0 1 0 1h-1v1a4.5 4.5 0 0 1-2.557 4.06c-.29.139-.443.377-.443.59v.7c0 .213.154.451.443.59A4.5 4.5 0 0 1 12.5 13v1h1a.5.5 0 0 1 0 1h-11zm2-13v1c0 .537.12 1.045.337 1.5h6.326c.216-.455.337-.963.337-1.5V2h-7zm3 6.35c0 .701-.478 1.236-1.011 1.492A3.5 3.5 0 0 0 4.5 13s.866-1.299 3-1.48V8.35zm1 0v3.17c2.134.181 3 1.48 3 1.48a3.5 3.5 0 0 0-1.989-3.158C8.978 9.586 8.5 9.052 8.5 8.351z"/>
									</svg>
				        		</div>
				        		<!-- beginning time search box -->
					        	<div class="col-md-3 ">
						        	<div class="form-group">
						        		<div class="form-floating">
						        			{% if startdate %}
						        				{{ form.year_begin(class="form-control", id="fromYear", placeholder="fromYear", type="number", value=startdate) }}
						        			{% else %}
						        				{{ form.year_begin(class="form-control", id="fromYear", placeholder="fromYear", type="number") }}
						        			{% endif %}
						        			
						        			<label for="fromYear">From year</label>
						        		</div>
						        	</div>
					        	</div>
					        	<!-- ending time search box -->
					        	<div class="col-md-3">
						        	<div class="form-group">
						        		<div class="form-floating">
						        			{% if enddate %}
						        				{{ form.year_end(class="form-control", id="toYear", placeholder="toYear", type="number", value=enddate) }}
						        			{% else %}
						        				{{ form.year_end(class="form-control", id="toYear", placeholder="toYear", type="number") }}
						        			{% endif %}
						        			
						        			<label for="toYear">To year</label>
						        		</div>
						        	</div>
					        	</div>	
								<span id="year_range_error_message" hidden>Invalid year range</span>
				        	</div>
				        	
				    	</div>
				    </div>

		 		</div>

		 		
		 	</div>	
	 	</div>
	 	
		<hr style="width: 80%">

	 		 
	</form>

	{% if lyrics or singer or startdate or enddate %}
		<span id="songs_per_page" hidden>{{songs_per_page}}</span>

		{% if total_pages > 1 %}
		<nav id="song_box_-1" aria-label="Page navigation example" style="padding-bottom: 5px">
			<ul class="pagination">
				<!-- left arrow -->
				{% if page_num == 1 %}
				<li class="page-item disabled">
			      <a class="page-link" href="#" aria-label="Previous" aria-disabled="true">
			        <span aria-hidden="true">&laquo;</span>
			      </a>
			    </li>
			    {% else %}
			    <li class="page-item">
			      <a class="page-link" href="{{ url_for('home', lyrics=lyrics, singer=singer, startdate=startdate, enddate=enddate, page_num=page_num - 1, total_pages=total_pages) }}" aria-label="Previous">
			        <span aria-hidden="true">&laquo;</span>
			      </a>
			    </li>
			    {% endif %}

			    <!-- page indexes -->
				{% for page_index in page_list %} 
					<!-- make the first page active -->
					{% if page_index == page_num %}
						<li  class="page-item active"><a class="page-link" href="#">{{page_index}}</a></li>
					{% else %}
						<li  class="page-item"><a class="page-link" href="{{ url_for('home', lyrics=lyrics, singer=singer, startdate=startdate, enddate=enddate, page_num=page_index, total_pages=total_pages) }}">{{page_index}}</a></li>
					{% endif %}
				{% endfor %}

				<!-- right arrow -->
				{% if page_num == total_pages %}
				<li class="page-item disabled">
			      <a class="page-link" href="#" aria-label="Previous" aria-disabled="true">
			        <span aria-hidden="true">&raquo;</span>
			      </a>
			    </li>
			    {% else %}
			    <li class="page-item">
			      <a class="page-link" href="{{ url_for('home', lyrics=lyrics, singer=singer, startdate=startdate, enddate=enddate, page_num=page_num + 1, total_pages=total_pages) }}" aria-label="Previous">
			        <span aria-hidden="true">&raquo;</span>
			      </a>
			    </li>
			    {% endif %}
			  

			</ul>
		</nav>
		{% endif %}
		</div>
		{% else %}
			</div>

    {% endif %}
	

    	{% if songs %}
		<div style="padding-bottom: 500px">
			{% for i in range(songs|length) %}
			<div id="song_box_{{i}}" class="card border-light mb-3" style="max-width: 800px;">
				<div class="card-header header-color" style="background-color: #5f788a; color: #ffffff;">
					Relevance: {{ relevance[i] }}
				</div>
				<div class="row g-0">
					<div class="col-md-4">
					<img class="article-img" src="{{ songs[i]['image_url'] }}" >
					</div>
					<div class="col-md-7">

					<div class="card-body">
						<h4 class="card-title" style="color:indigo">{{ songs[i]['title'] }}</h4>
						<p class="card-text"><span class="badge bg-success">Artist</span> {{ songs[i]['author'][0] }}</p>
						<p class="card-text"><span class="badge bg-info text-dark">Album</span>  {{ songs[i]['album'] }}</p>
						
						<p class="card-text">
							<div class="row g-0">
								<div class="col-md-4">
									<span class="badge bg-warning text-dark">Genre</span>  {{ songs[i]['tags'][0] }}
								</div>   
								<div class="col-md-8">
									<span class="badge bg-secondary">Release Date</span> {{ songs[i]['credits'].get('Release Date', [[""]])[0][0] }}
								</div>
							</div>
						</p>
						<!-- <p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p> -->
						<a href="{{ url_for('lyrics', song_id=songs[i]['_id'], relevance=relevance[i]) }}" class="stretched-link text-decoration-none"></a>
					</div>
				
					</div>

				</div>
			</div>
			{%endfor%}


		
	</div>
	{% endif %}
	


<script>

function addSpinner() {

  var x = document.getElementById("spinner");
  
  if (x.style.display === "none") {
    x.style.display = "";
  } else {
    x.style.display = "none";
  }
}

$( document ).ready(function() {

	$("#toYear").focusout(function() {
		validate_year_range()
	})
	$("#fromYear").focusout(function() {
		validate_year_range()
	})

	function validate_year_range() 
	{
		let fromYear = $("#fromYear").val()		
		let toYear   = $("#toYear").val()		
		
		fromYear = parseInt(fromYear)
		toYear   = parseInt(toYear)
		
		if (fromYear > toYear) {
			$("#submit").addClass("disabled")
			$("#year_range_error_message").attr('hidden', false)
		}
		else {
			$("#submit").removeClass("disabled")
			$("#year_range_error_message").attr('hidden', true)	
		}
	}
});

</script> 

{% endblock content %}


